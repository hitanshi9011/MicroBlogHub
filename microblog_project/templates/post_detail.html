{% extends 'base.html' %}
{% load static %}

{% block title %}Post by {{ post.user.username }} | MicroBlogHub{% endblock %}

{% block content %}
<div class="single-post-shell">
  <main class="single-post-main">
    <article class="post">
      <div class="avatar">{{ post.user.username|first|upper }}</div>
      <div class="post-main">
        <header class="post-header">
          <div>
            <a href="{% url 'profile' post.user.username %}">
              <span class="post-author-name">{{ post.user.username }}</span>
            </a>
            <span class="post-dot">¬∑</span>
            <span class="post-time">{{ post.created_at|timesince }} ago</span>
          </div>
        </header>

        <p class="post-body">{{ post.content }}</p>

        <footer class="post-footer">
          <div class="post-actions">
            <div class="like-section">
              {% if liked %}
                <a href="{% url 'unlike' post.id %}" class="action-btn liked">
                  <span class="action-icon">‚ù§Ô∏è</span>
                  <span class="action-count">{{ post.like_count }}</span>
                </a>
              {% else %}
                <a href="{% url 'like' post.id %}" class="action-btn">
                  <span class="action-icon">ü§ç</span>
                  <span class="action-count">{{ post.like_count }}</span>
                </a>
              {% endif %}
            </div>
          </div>
        </footer>

        <section class="comments-list">
          <h4>Comments ({{ post.comment_count }})</h4>
          {% for comment in comments %}
            <div class="comment-item">
              <div class="comment-avatar">{{ comment.user.username|first|upper }}</div>
              <div class="comment-content">
                <div class="comment-author">
                  <a href="{% url 'profile' comment.user.username %}"><strong>{{ comment.user.username }}</strong></a>
                  <span class="comment-time">{{ comment.created_at|timesince }} ago</span>
                </div>
                <div class="comment-text">{{ comment.text }}</div>
              </div>
            </div>
          {% empty %}
            <p>No comments yet</p>
          {% endfor %}

          {% if request.user.is_authenticated %}
            <form method="POST" action="{% url 'add_comment' post.id %}" class="comment-form">
              {% csrf_token %}
              <input type="text" name="comment" placeholder="Write a comment..." required>
              <button type="submit">Post</button>
            </form>
          {% else %}
            <p><a href="{% url 'login' %}">Log in</a> to comment.</p>
          {% endif %}
        </section>

      </div>
    </article>
  </main>

  <aside class="single-post-sidebar">
    <section class="trending-section">
      <h4>Trending</h4>
      <div class="hashtag-list">
        {% for tag in trending_hashtags %}
          <a href="{% url 'search' %}?q=%23{{ tag }}" class="hashtag-chip">#{{ tag }}</a>
        {% empty %}
          <p>No tags</p>
        {% endfor %}
      </div>

      <h4>Top posts</h4>
      <div class="trending-posts">
        {% for tpost in trending_posts %}
          <div class="tpost-row">
            <div class="avatar">{{ tpost.user.username|first|upper }}</div>
            <div class="tpost-main">
              <a href="{% url 'profile' tpost.user.username %}"><strong>{{ tpost.user.username }}</strong></a>
              <a href="{% url 'post_detail' tpost.id %}" class="tpost-link"><p class="tpost-snippet">{{ tpost.content|truncatechars:60 }}</p></a>
            </div>
          </div>
        {% endfor %}
      </div>
    </section>
  </aside>
</div>
{% endblock %}
